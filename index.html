<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ink Doodle</title>
  <link rel="stylesheet" href="./src/renderer/app.css" />
</head>
<body>
  <div class="app">
    <!-- Top App Bar -->
    <header class="topbar">
      <div class="topbar-left">
        <strong>Ink Doodle</strong>
        <span class="divider">â€¢</span>
        <span id="project-name" contenteditable="true" spellcheck="false">Untitled Project</span>
      </div>
       <div class="topbar-right">
        <button class="icon-btn" id="settings-btn" type="button" aria-label="Settings">âš™</button>

        <!-- Top-level app tabs: Story, Lore, Timeline -->
        <div class="top-tabs" role="tablist" aria-label="App Tabs">
          <button class="top-tab btn active" data-tab="story" type="button">Story</button>
          <button class="top-tab btn" data-tab="lore" type="button">Lore</button>
          <button class="top-tab btn" data-tab="timeline" type="button">Timeline</button>
        </div>

        <!-- Simple Logout (replaces dropdown) -->
        <button class="btn" id="logout-btn" type="button">Log out</button>
      </div>
    </header>
    <main class="main">
      <!-- Left Sidebar -->
      <aside class="sidebar" aria-label="Writing sidebar">
        <div class="sidebar-header">
          <h2>Writing</h2>
          <button class="btn" id="new-btn" type="button">+ New</button>
        </div>

        <div class="tabs" role="tablist" aria-label="Entry Types">
          <div class="tabs-writing">
            <button class="tab active" data-tab="chapters" role="tab" aria-selected="true" aria-controls="entry-list">Chapters</button>
            <button class="tab" data-tab="notes" role="tab" aria-selected="false" aria-controls="entry-list">Notes</button>
            <button class="tab" data-tab="references" role="tab" aria-selected="false" aria-controls="entry-list">References</button>
          </div>
          <!-- Lore uses a single unified entry type now; subtabs removed -->
        </div>

        <ul class="entry-list" id="entry-list" aria-label="Entries"></ul>

        <div class="sidebar-footer" title="Project path">
          C:\Users\You\Documents\InkDoodle
        </div>
      </aside>

      <!-- Editor Pane -->
      <section class="editor" aria-label="Editor">
        <div class="editor-header">
            <div class="title-row">
            <input
              class="title-input"
              id="title-input"
              placeholder="Untitled"
              value=""
              spellcheck="false"
              aria-label="Title"
            />
            <button class="btn danger" id="editor-delete-btn" type="button" title="Delete entry">ðŸ—‘ Delete</button>
          <!-- Top navigation handled in the header; removed duplicate mirrored buttons here -->
          </div>

            <div class="meta-row">
            <!-- Chapters: Status -->
            <label id="status-wrapper">
              Status
              <select id="status" aria-label="Status">
                <option>Draft</option>
                <option>Revise</option>
                <option>Final</option>
              </select>
            </label>

            <!-- Shared: Tags -->
            <label class="tags" id="tags-wrapper">
              Tags
              <input id="tags" placeholder="add tag and press Enter" aria-label="Tags"/>
            </label>

            <!-- Notes-only -->
            <label id="note-category-wrapper" class="meta-extra hidden">
              Category
              <select id="note-category" aria-label="Note Category">
                <option>Research</option>
                <option>Idea</option>
                <option>To-do</option>
                <option>Misc</option>
              </select>
            </label>

            <label id="note-pin-wrapper" class="meta-extra hidden">
              <input type="checkbox" id="note-pin" aria-label="Pin Note"/> Pin
            </label>

            <!-- References-only -->
            <label id="reference-type-wrapper" class="meta-extra hidden">
              Reference Type
              <select id="reference-type" aria-label="Reference Type">
                <option>Glossary</option>
                <option>Timeline</option>
                <option>Resource</option>
                <option>Misc</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Chapters: Synopsis; References repurpose as Summary -->
        <label class="section-label" id="synopsis-label" for="synopsis">Synopsis</label>
        <textarea id="synopsis" class="synopsis" placeholder="One-paragraph summary..." aria-label="Synopsis"></textarea>

        <!-- References-only: Source Link -->
        <label class="section-label" id="body-label" for="body">Body</label>
        <textarea id="body" class="body" placeholder="Start writing..." aria-label="Body"></textarea>

        <div class="bottom-bar" role="status">
          <div class="left-stats">
            <span id="word-count">Words: 0</span>
            <span class="dot">â€¢</span>
            <label class="goal-wrap" id="goal-wrap" title="Word Goal (chapters only)">
              Word Goal
              <input id="word-goal" type="number" min="0" step="50" inputmode="numeric" />
            </label>
            <div class="goal-progress" id="goal-progress" aria-hidden="true">
              <div class="bar"><div class="fill" id="goal-fill" style="width:0%"></div></div>
              <div class="pct" id="goal-pct">0%</div>
            </div>
          </div>

          <div class="sync-progress" id="sync-progress">
            <div class="spinner"></div>
            <span class="phase"></span>
            <div class="progress-bar">
              <div class="progress-fill"></div>
            </div>
            <span class="detail"></span>
          </div>
          <div class="right" id="save-state">Unsaved â€¢ Ctrl+S</div>
        </div>
      </section>

      <!-- Lore Editor Pane (UI-only placeholder) -->
      <section class="lore-editor hidden" id="lore-editor" aria-label="Lore Editor">
        <div class="lore-header" style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <div style="font-weight:700;">Lore Editor</div>
          <div>
            <button class="btn danger" id="editor-delete-btn" type="button" title="Delete entry">ðŸ—‘ Delete</button>
          </div>
        </div>

        <div class="lore-form" style="display:flex; flex-direction:column; gap:8px; margin-top:12px;">
          <input id="lore-title-input" class="title-input" placeholder="Untitled" aria-label="Lore title" spellcheck="false" />
          <input id="lore-kind-input" class="lore-kind-input" placeholder="Type (e.g. character)" aria-label="Lore type" />
          <input id="lore-tags" class="tags" placeholder="tags, comma separated" aria-label="Lore tags" />
          <label class="section-label" for="lore-summary">Summary</label>
          <textarea id="lore-summary" class="synopsis" placeholder="Short summary or description..." aria-label="Lore summary"></textarea>

          <label class="section-label" for="lore-body">Body</label>
          <textarea id="lore-body" class="body" placeholder="Write lore, characters, locations, timelines..." aria-label="Lore body"></textarea>
          
          <!-- Custom paired fields (creator-defined title + content) -->
          <div class="lore-custom-fields" style="display:flex; flex-direction:column; gap:12px; margin-top:8px;">
            <div class="pair">
              <label class="section-label" for="entry1name">Field 1 Name</label>
              <input id="entry1name" class="small-name-input" placeholder="Field 1 name" aria-label="Entry 1 name" />
              <label class="section-label" for="entry1content">Field 1 Content</label>
              <textarea id="entry1content" class="body" rows="4" placeholder="Field 1 content" aria-label="Entry 1 content"></textarea>
            </div>
            <div class="pair">
              <label class="section-label" for="entry2name">Field 2 Name</label>
              <input id="entry2name" class="small-name-input" placeholder="Field 2 name" aria-label="Entry 2 name" />
              <label class="section-label" for="entry2content">Field 2 Content</label>
              <textarea id="entry2content" class="body" rows="4" placeholder="Field 2 content" aria-label="Entry 2 content"></textarea>
            </div>
            <div class="pair">
              <label class="section-label" for="entry3name">Field 3 Name</label>
              <input id="entry3name" class="small-name-input" placeholder="Field 3 name" aria-label="Entry 3 name" />
              <label class="section-label" for="entry3content">Field 3 Content</label>
              <textarea id="entry3content" class="body" rows="4" placeholder="Field 3 content" aria-label="Entry 3 content"></textarea>
            </div>
            <div class="pair">
              <label class="section-label" for="entry4name">Field 4 Name</label>
              <input id="entry4name" class="small-name-input" placeholder="Field 4 name" aria-label="Entry 4 name" />
              <label class="section-label" for="entry4content">Field 4 Content</label>
              <textarea id="entry4content" class="body" rows="4" placeholder="Field 4 content" aria-label="Entry 4 content"></textarea>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Timeline Pane -->
      <section class="timeline hidden" id="timeline" aria-label="Timeline">
        <!-- Canvas: absolutely-positioned nodes will be placed inside -->
        <div id="timeline-canvas" class="timeline-canvas" tabindex="0" aria-label="Timeline canvas"></div>
        <div id="timeline-bottom-bar" class="timeline-bottom-bar" style="display:none; pointer-events:none; opacity:0.5;">
          <div class="timeline-bar-header" style="display: flex; align-items: flex-start; justify-content: space-between; padding: 0 8px 0 8px;">
            <div id="timeline-selector" class="timeline-selector" style="flex:1; display: flex; gap: 8px; align-items: center;">
              <!-- Timeline selector buttons will be injected here -->
            </div>
            <div class="timeline-bar-actions" style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
              <button id="timeline-create-btn" class="btn small" title="Create new relationship web" type="button">+</button>
            </div>
          </div>
          <!-- .timeline-horizontal-line is initialized here as the visual horizontal line for timeline markers -->
          <div class="timeline-horizontal-line"></div>
          <div class="timeline-bar-footer" style="display: flex; justify-content: flex-end; padding: 2px 8px 0 8px;">
            <div class="timeline-bar-actions" style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
              <button id="timeline-delete-btn" class="btn small" title="Delete current relationship web" type="button">ðŸ—‘</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Empty state overlay (shown when there are no entries) -->
  <div id="empty-state" class="empty-state" aria-live="polite" aria-atomic="true">
    <div class="empty-card">
      <h3>No entries yet</h3>
      <p>Create your first item to start writing.</p>
      <div class="actions">
        <button class="btn primary" data-new="chapter" type="button">+ New Chapter</button>
        <button class="btn" data-new="note" type="button">+ New Note</button>
        <button class="btn" data-new="reference" type="button">+ New Reference</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="settings-modal hidden" role="dialog" aria-modal="true" aria-label="Settings">
    <div class="settings-card">
      <div class="settings-head">
        <h3>Settings</h3>
        <button class="icon-btn" id="settings-close" aria-label="Close">âœ•</button>
      </div>

     <!-- NEW: Appearance mode toggle + a single dynamic select -->
      <div class="settings-section">
        <div class="row">
          <label class="toggle">
            <span>Theme/Background</span>
            <input id="appearance-mode" type="checkbox" role="switch" aria-label="Toggle Theme/Background">
            <span class="toggle-track" aria-hidden="true">
              <span class="toggle-thumb"></span>
            </span>
          </label>

          <label>
            <span id="appearance-label">Theme</span>
            <select id="appearance-select" aria-label="Theme or Background"></select>
          </label>
        </div>
      </div>

      <!-- NEW: Visual tweaks kept together -->
      <div class="settings-section">
        <div class="row">
          <label>Overlay Opacity
            <input id="bg-opacity" type="range" min="0" max="60" step="5" value="20" />
          </label>
          <label>Blur
            <input id="bg-blur" type="range" min="0" max="8" step="1" value="2" />
          </label>
        </div>
        <div class="row">
          <label class="checkbox">
            <input id="dim-editor" type="checkbox" checked />
            Dim editor background for readability
          </label>
        </div>
      </div>

      <div class="settings-foot">
        <button class="btn" id="settings-reset">Reset to Defaults</button>
        <div class="spacer"></div>
        <button class="btn primary" id="settings-done">Done (Esc)</button>
      </div>
    </div>
   </div>

  <!-- Login Modal -->
  <div id="login-modal" class="settings-modal hidden" role="dialog" aria-modal="true" aria-label="Login">
    <div class="settings-card" style="max-width:420px;">
      <div class="settings-head">
        <h3>Sign in</h3>
        <button class="icon-btn" id="login-cancel" aria-label="Close">âœ•</button>
      </div>

      <div class="settings-section">
        <div class="row" style="flex-direction:column; gap:8px;">
          <label>Email</label>
          <input id="login-email" type="email" placeholder="you@example.com" autocomplete="email" />
          <div id="login-error" role="alert" style="color:#b91c1c; font-size:12px; min-height:1.2em;"></div>
        </div>
      </div>

      <div class="settings-foot">
        <div class="spacer"></div>
        <button class="btn primary" id="login-submit">Sign in</button>
      </div>
    </div>
  </div>
  <!-- Login Modal -->

  <script src="./src/renderer/app.js"></script>
</body>
</html>